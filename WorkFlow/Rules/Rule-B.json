{
    "name": "Rule B - Validate Announcement Eligibility",
    "steps": [
        {
            "action": "log",
            "message": "[Rule B] Starting eligibility check for Person ID: @person.Id, Name: @person.Name, Age: @person.Age"
        },
        {
            "action": "fetchList",
            "entity": "Announcements",
            "filter": {},
            "storeAs": "announcements"
        },
        {
            "action": "log",
            "message": "[Rule B] Fetched total @announcements.Count announcements for evaluation."
        },
        {
            "action": "assign",
            "variable": "foundValidAnnouncement",
            "value": false
        },
        {
            "action": "foreach",
            "source": "announcements",
            "var": "announcement",
            "body": [
                {
                    "action": "log",
                    "message": "[Rule B] Evaluating announcement ID: @announcement.Id | RequiredAge: @announcement.RequiredAge | RequiredWorkType: @announcement.WorkType"
                },
                {
                    "action": "if",
                    "condition": {
                        "field": "announcement.RequiredAge",
                        "operator": "<=",
                        "value": "@person.Age"
                    },
                    "then": [
                        {
                            "action": "log",
                            "message": "[Rule B] Person's age (@person.Age) meets requirement (>= @announcement.RequiredAge). Fetching work histories..."
                        },
                        {
                            "action": "fetchList",
                            "entity": "WorkHistories",
                            "filter": { "PersonId": "@person.Id" },
                            "storeAs": "personWorkHistories"
                        },
                        {
                            "action": "log",
                            "message": "[Rule B] Retrieved @personWorkHistories.Count work history records for Person ID: @person.Id"
                        },
                        {
                            "action": "foreach",
                            "source": "personWorkHistories",
                            "var": "history",
                            "body": [
                                {
                                    "action": "log",
                                    "message": "[Rule B] Checking work history ID: @history.Id | WorkType: @history.WorkType | Start: @history.StartDate | End: @history.EndDate"
                                },
                                {
                                    "action": "if",
                                    "condition": {
                                        "field": "history.WorkType",
                                        "operator": "==",
                                        "value": "@announcement.WorkType"
                                    },
                                    "then": [
                                        {
                                            "action": "log",
                                            "message": "[Rule B] WorkType matches announcement requirement. Calculating experience duration in years..."
                                        },
                                        {
                                            "action": "calculateDuration",
                                            "startDate": "history.StartDate",
                                            "endDate": "history.EndDate",
                                            "unit": "Years",
                                            "storeAs": "DurationInYears"
                                        },
                                        {
                                            "action": "log",
                                            "message": "[Rule B] Experience duration for history ID @history.Id: @DurationInYears years"
                                        },
                                        {
                                            "action": "if",
                                            "condition": {
                                                "field": "DurationInYears",
                                                "operator": ">=",
                                                "value": 5
                                            },
                                            "then": [
                                                {
                                                    "action": "log",
                                                    "message": "[Rule B] Found qualifying announcement match: >= 5 years experience in required WorkType."
                                                },
                                                {
                                                    "action": "assign",
                                                    "variable": "foundValidAnnouncement",
                                                    "value": true
                                                },
                                                { "action": "break" }
                                            ],
                                            "else": [
                                                {
                                                    "action": "log",
                                                    "message": "[Rule B] Experience duration less than 5 years for this history. Continuing evaluation..."
                                                },
                                                { "action": "continue" }
                                            ]
                                        }
                                    ],
                                    "else": [
                                        {
                                            "action": "log",
                                            "message": "[Rule B] WorkType does not match announcement requirement. Skipping this history."
                                        },
                                        { "action": "continue" }
                                    ]
                                }
                            ]
                        }
                    ],
                    "else": [
                        {
                            "action": "log",
                            "message": "[Rule B] Person age (@person.Age) does not meet announcement required age (@announcement.RequiredAge). Skipping announcement."
                        },
                        { "action": "continue" }
                    ]
                }
            ]
        },
        {
            "action": "if",
            "condition": {
                "field": "foundValidAnnouncement",
                "operator": "==",
                "value": true
            },
            "then": [
                {
                    "action": "log",
                    "message": "[Rule B] Rule passed: Person matched an announcement with required experience."
                },
                {
                    "action": "stop",
                    "reason": "Rule B passed: Person matched announcement with 5+ years experience.",
                    "status": true
                }
            ],
            "else": [
                {
                    "action": "log",
                    "message": "[Rule B] Rule failed: No announcements matched or insufficient experience."
                },
                {
                    "action": "stop",
                    "reason": "Rule B failed: No matching announcement or insufficient experience.",
                    "status": false
                }
            ]
        }
    ]
}
