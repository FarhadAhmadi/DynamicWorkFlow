{
    "name": "Rule A - Validate 1 year تهران experience with confirmed employer",
    "steps": [
        {
            "action": "log",
            "message": "[Rule A] Starting validation for Person ID: @person.Id, Name: @person.Name"
        },
        {
            "action": "fetchList",
            "entity": "WorkHistories",
            "filter": { "PersonId": "@person.Id" },
            "storeAs": "histories"
        },
        {
            "action": "log",
            "message": "[Rule A] Retrieved @histories.Count work history records for Person ID: @person.Id"
        },
        {
            "action": "assign",
            "variable": "foundValidHistory",
            "value": false
        },
        {
            "action": "foreach",
            "source": "histories",
            "var": "history",
            "body": [
                {
                    "action": "log",
                    "message": "[Rule A] Processing history ID: @history.Id | Location: @history.Location | Start: @history.StartDate | End: @history.EndDate"
                },
                {
                    "action": "if",
                    "condition": {
                        "field": "history.Location",
                        "operator": "==",
                        "value": "تهران"
                    },
                    "then": [
                        {
                            "action": "log",
                            "message": "[Rule A] Work history ID @history.Id is in location تهران. Proceeding to calculate duration..."
                        },
                        {
                            "action": "calculateDuration",
                            "startDate": "history.StartDate",
                            "endDate": "history.EndDate",
                            "unit": "days",
                            "storeAs": "DurationInDays"
                        },
                        {
                            "action": "log",
                            "message": "[Rule A] Duration for history ID @history.Id: @DurationInDays days"
                        },
                        {
                            "action": "if",
                            "condition": {
                                "field": "DurationInDays",
                                "operator": ">=",
                                "value": 365
                            },
                            "then": [
                                {
                                    "action": "log",
                                    "message": "[Rule A] Duration is >= 365 days. Verifying employer confirmation for Employer ID: @history.Employer.Id"
                                },
                                {
                                    "action": "fetch",
                                    "entity": "Employers",
                                    "filter": { "Id": "@history.Employer.Id" },
                                    "storeAs": "employer"
                                },
                                {
                                    "action": "log",
                                    "message": "[Rule A] Employer fetched: @employer.Name (ID: @employer.Id), HasConfirmation: @employer.HasConfirmation"
                                },
                                {
                                    "action": "if",
                                    "condition": {
                                        "field": "employer.HasConfirmation",
                                        "operator": "==",
                                        "value": true
                                    },
                                    "then": [
                                        {
                                            "action": "log",
                                            "message": "[Rule A] Employer confirmation is true. Valid work history found. Rule A will pass."
                                        },
                                        {
                                            "action": "assign",
                                            "variable": "foundValidHistory",
                                            "value": true
                                        },
                                        { "action": "break" }
                                    ],
                                    "else": [
                                        {
                                            "action": "log",
                                            "message": "[Rule A] Employer confirmation is false. Rule A will fail for Person ID: @person.Id"
                                        },
                                        {
                                            "action": "stop",
                                            "reason": "Rule A failed: Employer not confirmed for qualifying history.",
                                            "status": false
                                        }
                                    ]
                                }
                            ],
                            "else": [
                                {
                                    "action": "log",
                                    "message": "[Rule A] Duration is less than 365 days for history ID: @history.Id. Skipping."
                                },
                                { "action": "continue" }
                            ]
                        }
                    ],
                    "else": [
                        {
                            "action": "log",
                            "message": "[Rule A] Location of history ID: @history.Id is not تهران. Skipping."
                        },
                        { "action": "continue" }
                    ]
                }
            ]
        },
        {
            "action": "if",
            "condition": {
                "field": "foundValidHistory",
                "operator": "==",
                "value": true
            },
            "then": [
                {
                    "action": "log",
                    "message": "[Rule A] Rule passed: Found valid work history in تهران with confirmed employer for at least 1 year."
                },
                {
                    "action": "stop",
                    "reason": "Rule A passed: 1+ year confirmed work in تهران found.",
                    "status": true
                }
            ],
            "else": [
                {
                    "action": "log",
                    "message": "[Rule A] Rule failed: No valid work history in تهران with confirmed employer found."
                },
                {
                    "action": "stop",
                    "reason": "Rule A failed: No valid تهران work history found.",
                    "status": false
                }
            ]
        }
    ]
}
